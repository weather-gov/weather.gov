name: code standards
on:
  pull_request:
  merge_group:

jobs:
  php-lint:
    name: Drupal code standards lint
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v3

      - name: setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: "8.2"

      - name: get composer cache directory
        id: composer-cache
        run: echo "dir=$(composer config cache-files-dir)" >> $GITHUB_OUTPUT

      - name: cache
        uses: actions/cache@v3
        with:
          path: ${{ steps.composer-cache.outputs.dir }}
          key: phpcs-cache

      - name: run phpcs
        run: |
          composer global config allow-plugins true
          composer global require drupal/coder
          phpcs
