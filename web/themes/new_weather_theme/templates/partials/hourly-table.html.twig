{% set times = hours | map(h => h.time) | json_encode %}
{% set temps = hours | map(h => h.temperature) | json_encode %}
{% set feelsLike = hours | map(h => h.apparentTemperature) | json_encode %}
{% set pops = hours | map(h => h.probabilityOfPrecipitation) | json_encode %}
{% set dewpoints = hours | map(h => h.dewpoint) | json_encode %}
{% set relativeHumidity = hours | map(h => h.relativeHumidity) | json_encode %}
{% set windSpeeds = hours | map(h => h.windSpeed) | json_encode %}
{% set windGusts = hours | map(h => h.windGust) | json_encode %}
{% set windDirections = hours | map(h => h.windDirection) | json_encode %}

<wx-hourly-table class="display-block position-relative margin-top-2 bg-white">
  <h5 class="wx-visual-h3 font-heading-md text-normal text-primary-darker margin-top-0 margin-bottom-205">Hourly forecast</h5>

  <div class="display-flex flex-justify">
    <div>
      <button class="wx-scroll-button bg-gray-30 circle-5 border-0 text-white display-flex flex-align-center flex-justify-center padding-y-1px padding-x-05" data-direction="left" type="button" role="button">
        <span class="usa-sr-only">{{ "scroll left" | t }}</span>
        <svg class="usa-icon usa-icon--size-3" aria-hidden="true" focusable="false" role="img">
          <use xlink:href="/themes/new_weather_theme/assets/images/uswds/sprite.svg#arrow_back"></use>
        </svg>
      </button>
    </div>
    <div>
      <button class="wx-scroll-button bg-gray-30 circle-5 border-0 text-white display-flex flex-align-center flex-justify-center padding-y-1px padding-x-05" data-direction="right" type="button" role="button">
        <span class="usa-sr-only">{{ "scroll right" | t }}</span>
        <svg class="usa-icon usa-icon--size-3" aria-hidden="true" focusable="false" role="img">
          <use xlink:href="/themes/new_weather_theme/assets/images/uswds/sprite.svg#arrow_forward"></use>
        </svg>
      </button>
    </div>
  </div>

  <div id="hourly-table-container" class="usa-table-container--scrollable">
    <table class="usa-table usa-table--borderless hourly-table" tabindex="0" {% if alertPeriods | length > 0 %} data-has-alerts="true" {% else %} data-has-alerts="false" {% endif %}>
      <caption class="usa-sr-only">{{ "Detailed hourly weather data for @place. The rows are weather variables, the columns are hours." | t({ "@place": for }) }}</caption>
      <tbody data-table-section="time-alerts" class="border-bottom-1px border-base-light">
      <tr data-row-name="time">
        <th scope="row" class="position-sticky left-0 font-family-mono text-base-lightest font-mono-xs text-uppercase z-400">{{ "Time" | t }}</th>
        {% for period in hours %}
        <th scope="col">
          <time datetime="{{period.timestamp}}" class="font-family-mono font-mono-xs text-base-lightest">
            {{ period.time }}
          </time>
        </th>
        {% endfor %}
      </tr>
      {%  if alertPeriods | length > 0 %}
      {% include '@new_weather_theme/partials/alerts-in-hourly-table.html.twig' with { 'periods': hours, 'alertPeriods': alertPeriods } %}
      {% endif %}
      </tobdy>
      <tbody data-table-section="variables">
        <tr data-row-name="temp">
          <th scope="row" class="position-sticky left-0 font-family-mono text-primary-dark font-mono-xs text-uppercase z-400">
            {{"Temperature" | t}}
          </th>
          {% for period in hours %}
          <td>
            {% if period.temperature is not same as (null) %}
            {{ period.temperature }}<span aria-hidden="true" class="font-sans-3xs text-ttop padding-left-1px">&deg;F</span>
            <span class="usa-sr-only">℉</span>
            {% else %}
            <span class="text-base font-mono-xs"> {{ "N/A" | t }} </span>
            {% endif %}
          </td>
          {% endfor %}
        </tr>
        <tr data-row-name="apparentTemp">
          <th scope="row" class="position-sticky left-0 font-family-mono text-primary-dark font-mono-xs text-uppercase z-400">
            {{"Feels like" | t}}
          </th>
          {% for period in hours %}
          <td>
            {% if period.apparentTemperature is not same as (null) %}
            {{ period.apparentTemperature }}<span aria-hidden="true" class="font-sans-3xs text-ttop padding-left-1px">&deg;F</span>
            <span class="usa-sr-only">℉</span>
            {% endif %}
          </td>
          {% endfor %}
        </tr>
        <tr data-row-name="condition">
          <th scope="row" class="position-sticky left-0 font-family-mono text-primary-dark font-mono-xs text-uppercase z-400">
            {{"Condition" | t}}
          </th>
          {% for period in hours %}
          <td>
            {% if period.icon.icon %}
            <div class="line-height-sans-3">
              <div class="icon margin-right-1 width-3 margin-top-05">
                <svg role="img" aria-hidden="true" class="maxh-3 maxw-3">
                  <use xlink:href="{{ "/" ~ directory ~ "/assets/images/spritesheet.svg#" ~ period.icon.base }}"></use>
                </svg>
              </div>
              <div>
                {% if period.conditions | length %}
                <p class="margin-y-0">{{period.conditions}}</p>
                {% else %}
                <span class="text-base font-mono-xs"> {{ "N/A" | t }} </span>
                {% endif %}
              </div>
            </div>
            {% endif %}
          </td>
          {% endfor %}
        </tr>
        <tr data-row-name="chance-precipitation">
          <th scope="row" class="position-sticky left-0 font-family-mono text-primary-dark bg-primary-lightest font-mono-xs text-uppercase z-400">
            {{"Chance of precipitation" | t}}
          </th>
          {% for period in hours %}
          <td> 
            {% if period.probabilityOfPrecipitation is not same as (null) %}
            <p class="margin-y-0"> {{period.probabilityOfPrecipitation}}% </p>
            {% else %}
            <span class="text-base font-mono-xs"> {{ "N/A" | t }} </span>
            {% endif %}
          </td>
          {% endfor %}
        </tr>

        <tr data-row-name="wind-speed">
          <th scope="row" class="position-sticky left-0 font-family-mono text-primary-dark bg-primary-lightest font-mono-xs text-uppercase z-400">
            {{"Wind speed" | t}}
          </th>
          {% for period in hours %}
          <td>
            {% include '@new_weather_theme/partials/wind.html.twig'
              with {
                wind: {
                  speed: period.windSpeed,
                  direction: period.windDirection
                }
              }
            %}
            {% if period.windGust is not same as (null) %}
              <div>{{ "with gusts up to @gustSpeed mph" | t({ "@gustSpeed": period.windGust }) }}</div>
            {% endif %}
          </td>
          {% endfor %}
        </tr>
        <tr data-row-name="humidity">
          <th scope="row" class="position-sticky left-0 font-family-mono text-primary-dark font-mono-xs text-uppercase z-400">
            {{"Humidity" | t}}
          </th>
          {% for period in hours %}
          <td>
            {% if period.relativeHumidity is not same as (null) %}
            {{period.relativeHumidity}}%
            {% else %}
            <span class="text-base font-mono-xs"> {{ "N/A" | t }} </span>
            {% endif %}
          </td>
          {% endfor %}
        </tr>
        <tr data-row-name="dewpoint">
          <th scope="row" class="position-sticky left-0 font-family-mono text-primary-dark font-mono-xs text-uppercase z-400">
            {{"Dewpoint" | t}}
          </th>
          {% for period in hours %}
          <td>
            {% if period.dewpoint is not same as (null) %}
            {{period.dewpoint}}<span aria-hidden="true" class="font-sans-3xs text-ttop padding-left-1px">&deg;F</span>
            <span class="usa-sr-only">℉</span>
            {% else %}
            <span class="text-base font-mono-xs"> {{ "N/A" | t }} </span>
            {% endif %}
          </td>
          {% endfor %}
        </tr>
      </tbody>
    </table>
  </div>

  <div class="margin-top-3 margin-bottom-4">
    <span class="font-family-mono text-primary-dark">
      {{ "Temperature" | t }}
    </span>
    <div class="wx-hourly-temp-chart-container margin-bottom-105 position-relative grid-col-12 width-full overflow-x-auto" data-times="{{ times }}" data-temps="{{ temps }}" data-feels-like="{{ feelsLike }}">
      <div class="maxh-card-lg" style="width: max(100%, calc(var(--chart-datapoint-width) * {{times | split(',') | length}}))">
          <canvas>
          </canvas>
        </div>
      </div>
    <div class="display-flex flex-align-center font-mono-xs text-base">
      <div class="width-3 border-bottom-2px border-primary-dark height-0 margin-right-1">
        <div class="bg-primary-dark margin-left-1 radius-pill width-1 height-1" style="margin-top: -3px;"></div>
      </div>
      {{ "Temperature" | t }}
      <div class="margin-left-3 width-3 border-bottom-2px border-top-0 border-left-0 border-right-0 border-dotted border-primary-light height-0 margin-right-1">
        <div class="bg-primary-light margin-left-1 radius-pill width-1 height-1" style="margin-top: -3px;"></div>
      </div>
      {{  "Feels like" | t }}
    </div>
  </div>

  <div class="margin-bottom-2">
    <span class="font-family-mono text-primary-dark">{{"Chance of precipitation" | t }}</span>
    <div class="wx-hourly-pops-chart-container position-relative grid-col-12 width-full overflow-x-auto" data-times="{{ times }}" data-pops="{{ pops }}">
      <div class="maxh-card-lg" style="width: max(100%, calc(var(--chart-datapoint-width) * {{times | split(',') | length}}))">
        <canvas>
        </canvas>
      </div>
    </div>
  </div>

  <div class="margin-bottom-4">
    <span class="font-family-mono text-primary-dark">{{ "Wind" | t }}</span>
    <div class="wx-hourly-wind-chart-container margin-bottom-105 position-relative grid-col-12 width-full overflow-x-auto" data-times="{{ times }}" data-wind-speeds="{{ windSpeeds }}" data-wind-gusts="{{ windGusts }}" data-wind-directions="{{ windDirections }}">
      <div class="maxh-card-lg" style="width: max(100%, calc(var(--chart-datapoint-width) * {{times | split(',') | length}}))">
        <canvas></canvas>
      </div>
    </div>
    <div class="display-flex flex-align-center font-mono-xs text-base">
      <div class="width-3 border-bottom-2px border-secondary-darker height-0 margin-right-1">
        <div class="bg-primary-dark margin-left-1 radius-pill width-1 height-1" style="margin-top: -3px;"></div>
      </div>
      {{ "Wind speed" | t }}
      <div class="margin-left-3 width-3 border-bottom-2px border-top-0 border-left-0 border-right-0 border-dotted border-secondary height-0 margin-right-1">
        <div class="bg-secondary margin-left-1 radius-pill width-1 height-1" style="margin-top: -3px;"></div>
      </div>
      {{  "Gusts" | t }}
    </div>
  </div>

  <div class="margin-bottom-2">
    <span class="font-family-mono text-primary-dark"> {{"Humidity" | t }} </span>
    <div class="wx-hourly-humidity-chart-container position-relative grid-col-12 width-full overflow-x-auto" data-times="{{ times }}" data-humidity="{{ relativeHumidity }}">
      <div class="maxh-card-lg" style="width: max(100%, calc(var(--chart-datapoint-width) * {{times | split(',') | length}}))">
        <canvas>
        </canvas>
      </div>
    </div>
  </div>

  <div class="margin-bottom-0">
    <span class="font-family-mono text-primary-dark">{{"Dewpoint" | t }}</span>
    <div class="wx-hourly-dewpoint-chart-container position-relative grid-col-12 width-full overflow-x-auto" data-times="{{ times }}" data-dewpoints="{{ dewpoints }}">
      <div class="maxh-card-lg" style="width: max(100%, calc(var(--chart-datapoint-width) * {{times | split(',') | length}}))">
        <canvas>
        </canvas>
      </div>
    </div>
  </div>

</wx-hourly-table>
