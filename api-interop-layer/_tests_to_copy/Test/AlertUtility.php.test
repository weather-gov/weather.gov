<?php

namespace Drupal\weather_data\Service\Test;

use Drupal\weather_data\Service\AlertUtility;
use PHPUnit\Framework\TestCase;

/**
 * Tests for the AlertUtility helper class.
 */
final class AlertUtilityTest extends TestCase
{
    /**
     * @group unit
     * @group alert-utility
     */
    public function testSortsAlertsCorrectly(): void
    {
        $now = new \DateTimeImmutable();

        $alerts = [
            (object) [
                "event" => "flood watch",
                "onset" => $now->modify("-1 hour"),
            ],
            (object) [
                "event" => "air quality alert",
                "onset" => $now->modify("+1 hour"),
            ],
            (object) [
                "event" => "volcano warning",
                "onset" => $now->modify("-1 hour"),
            ],
            (object) [
                "event" => "tornado warning",
                "onset" => $now->modify("-1 hour"),
            ],
            (object) [
                "event" => "dust storm warning",
                "onset" => $now->modify("-1 hour"),
            ],
            (object) [
                "event" => "volcano warning",
                "onset" => $now->modify("+2 hour"),
            ],
            (object) [
                "event" => "air quality alert",
                "onset" => $now->modify("+2 hours"),
            ],
            (object) [
                "event" => "air quality alert",
                "onset" => $now->modify("+3 hour"),
            ],
        ];

        $expected = [
            $alerts[3], // active tornado warning
            $alerts[4], // active volcano warning
            $alerts[2], // active dust storm warning
            $alerts[0], // active flood watch
            $alerts[1], // next hour air quality alert
            $alerts[5], // in two hours volcano warning
            $alerts[6], // in two hours air quality alert
            $alerts[7], // in three hours air quality alert
        ];

        $actual = AlertUtility::sort($alerts);

        $this->assertEquals($expected, $actual);
    }
}
